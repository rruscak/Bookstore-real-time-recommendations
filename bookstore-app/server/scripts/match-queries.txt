MATCH (b1:Book)
WHERE id(b1) = 28
MATCH path = ((b1)-[rel:HAS_SEQUEL|:WRITER_OF|:HAS_CATEGORY|:HAS_KEYWORD|:PUBLISHER_OF*..5]-(b2:Book))
WHERE b2 != b1
RETURN DISTINCT b2.title, length(path) AS relsInCommon
ORDER BY relsInCommon ASC, b2.title
LIMIT 5


// RETURN Books with most relations to another one
MATCH (b1:Book)
WHERE id(b1) = 28
MATCH p = (b1)-[:HAS_SEQUEL|WRITER_OF|HAS_CATEGORY|HAS_KEYWORD|PUBLISHER_OF*..3]-(b2:Book)
WHERE b2 <> b1
WITH b2, relationships(p) AS rel
OPTIONAL MATCH (b2)-[:HAS_IMAGE]->(i:Image)
OPTIONAL MATCH (b2)<-[:WRITER_OF]-(w:Writer)
OPTIONAL MATCH (:User)-[ratRel:RATED]->(b2)
WITH b2, i, w, avg(ratRel.rating) AS rating, count(rel) AS relsInCommon
RETURN {id: id(b2), title: b2.title, writer: w.name, price: b2.price, rating: rating, image: collect(DISTINCT i), relsInCommon: relsInCommon} AS book
ORDER BY book.relsInCommon DESC, book.title
LIMIT 5

// Books has in common
MATCH (b1:Book)
WHERE id(b1) = 28
MATCH path = allShortestPaths((b1)-[rel:HAS_SEQUEL|WRITER_OF|HAS_CATEGORY|HAS_KEYWORD|PUBLISHER_OF*..10]-(b2:Book))
WHERE b2 <> b1
RETURN path, length(path) AS path_length

// Two books in common
WHERE id(b1) = 28
WITH b1
MATCH (b2:Book)
WHERE id(b2) = 30
MATCH path = (b1)-[rel:HAS_SEQUEL|WRITER_OF|HAS_CATEGORY|HAS_KEYWORD|PUBLISHER_OF*..4]-(b2)
RETURN path, length(path) AS path_length
